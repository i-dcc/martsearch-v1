{
  active:             true,
  debug_mode:         false,
  internal_name:      "htgt_targ_alleles",
  display_name:       "KOMP/EUCOMM Vectors and ES Cells",
  url:                "/htgt/biomart",
  full_url:           "http://www.sanger.ac.uk/htgt/biomart",
  mart_dataset:       "htgt_targ",
  joined_index_field: "marker_symbol",
  joined_filter:      "marker_symbol",
  template:           "htgt_targ_details.ejs",
  enabled_attributes: [
    "is_eucomm",
    "is_komp_csd",
    "is_komp_regeneron",
    "is_norcomm",
    "is_mgp",
    "marker_symbol",
    "ensembl_gene_id",
    "status",
    "status_code",
    "status_type",
    "status_description",
    "status_sequence",
    "pipeline_stage",
    "htgt_project_id",
    "bac",
    "design_id",
    "design_plate",
    "design_well",
    "intvec_plate",
    "intvec_well",
    "intvec_distribute",
    "targvec_plate",
    "targvec_well",
    "targvec_distribute",
    "backbone",
    "cassette",
    "allele_name",
    "escell_clone_name",
    "escell_distribute",
    "es_cell_line",
    "colonies_picked",
    "is_latest_for_gene",
    "is_targeted_non_cond"
  ],
  custom_result_parser: function ( data, ds, docs ) {
    var results = {};
    var int_results = ds._biomart_tsv2json_ah( data );
    
    // Process the biomart return and organise into projects...
    for (var i=0; i < int_results.length; i++) {
      var result = int_results[i];
      
      // Only store a result if we have a htgt_project_id and it's not a regeneron project
      if ( result["htgt_project_id"] && result["is_komp_regeneron"] !== "1" && result["is_norcomm"] !== "1"
           && (result["status_sequence"] >= 95)) {
        // Set the DOM element id we need to lookup
        var content_id = ds.internal_name + '_' + result["marker_symbol"].replace( /\(/g, "-" ).replace( /\)/g, "-" ).replace( /\*/g, "-" ).substr(0,20);
        
        // Find or create a result and project entry
        if ( results[ content_id ] == undefined ) { results[ content_id ] = {}; };

        if ( results[ content_id ][ result["htgt_project_id"] ] == undefined ) {
          results[ content_id ][ result["htgt_project_id"] ] = {};
        };

        var project = results[ content_id ][ result["htgt_project_id"] ];

        // Extract the singular (per project) values
        var singular_attributes = [
          "is_eucomm",
          "is_komp_csd",
          "is_komp_regeneron",
          "is_norcomm",
          "is_mgp",
          "marker_symbol",
          "ensembl_gene_id",
          "status",
          "status_code",
          "status_type",
          "status_description",
          "status_sequence",
          "pipeline_stage",
          "htgt_project_id",
          "bac",
          "design_id",
          "design_plate",
          "design_well",
          "intvec_plate",
          "intvec_well",
          "intvec_distribute",
          "targvec_plate",
          "targvec_well",
          "targvec_distribute",
          "backbone",
          "cassette",
          "allele_name",
          "is_latest_for_gene"
        ];

        for (var j=0; j < singular_attributes.length; j++) {
          project[ singular_attributes[j] ] = result[ singular_attributes[j] ];
        };

        if ( result["escell_clone_name"] && ( result["escell_distribute"] || result["is_targeted_non_cond"] ) ) {
          var show_in_trap_box = 0;
          if( result ["is_targeted_non_cond"] ){
            show_in_trap_box = 1;
          }
          // Find or create ES Cell entries for the project
          if ( project["escells"] == undefined ) { project["escells"] = []; };
          
          project["escells"].push({
            escell_clone_name:      result["escell_clone_name"],
            es_cell_line:           result["es_cell_line"],
            colonies_picked:        result["colonies_picked"],
            escell_distribute:      result["escell_distribute"],
            is_targeted_non_cond:  result["is_targeted_non_cond"],
            show_in_trap_box:  show_in_trap_box
          });
        };
      };
      
    };
    
    return results;
  },
  post_display_hook: function( content_id ) {
    jQuery('#'+content_id+" a[rel^='prettyPhoto']").prettyPhoto();
    jQuery('#'+content_id+" table.tablesorter").tablesorter({ widgets: ['zebra'], sortList: [[0,0]] });
    jQuery('#'+content_id+' .htgt_targ_allele_progress_clones_toggle').toggleControl('#'+content_id+' .htgt_targ_allele_progress_clones_content', { speed: "fast" });
    jQuery('#'+content_id+' .htgt_targ_allele_progress_toggle').toggleControl('#'+content_id+' .htgt_targ_allele_progress_content', { speed: "fast" });
  }
}
