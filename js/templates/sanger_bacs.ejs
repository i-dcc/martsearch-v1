<table class="phenotyping with_border">
  <thead>
    <tr>
        <th>C57Bl/6J Bacs</th>
        <th>129 Bacs</th>
        <th>MICER clones</th>
        <th>View in Ensembl</th>
    </th>
  </thead>
  <%
     var s7_count = 0;
     var micer_count = 0;
     var b6_count = 0;
     var chr = "";
     var min_left = -1;
     var max_right = -1;
     var max_left = -1;
     var min_right = -1;
     for ( var i=0; i < results.length; i++ ) {
        var result = results[i];
        if (result['library'] == '127S7') {
          s7_count++;
        }
        if (result['library'] == 'C57Bl/6J'){
          b6_count++;
        }
        if (result['library'] == 'MICER'){
          micer_count++;
        }
        chr = result["chromosome"];
        var start = result["start"];
        var end = result["end"];
        if( (min_left<0) || (min_left > start) ){
            min_left = start;
        }
        if( max_right < end ){
            max_right = end;
        }
        if( (max_left<0) || (max_left < start) ){
            max_left = start;
        }
        if( (min_right < 0) || (end < min_right) ){
            min_right = end;
        }
     }
     
     if(min_right < max_left){
        var tmp = min_right;
        min_right = max_left;
        max_left = tmp;
     }
     
     max_left = max_left - 10000;
     //this because javascript seems to string-concat if I use a naked '+'
     min_right = min_right - (-1 * 10000);
     
    // Configure our link out to Ensembl...
    var tracks_to_change = {
      contig:                                         "normal",
      ruler:                                          "normal",
      scalebar:                                       "normal",
      transcript_core_ensembl:                        "compact",
      transcript_vega_otter:                          "off",
      alignment_compara_364_constrained:              "off",
      "das:http://das.sanger.ac.uk/das/ens_m37_129AB22":   "normal",
      "das:http://das.sanger.ac.uk/das/ens_m37_micer":   "normal",
      "das:http://das.sanger.ac.uk/das/ens_m37_bacmap":   "normal",
      alignment_compara_364_scores:                   "off",
      chr_band_core:                                  "off",
      dna_align_cdna_cDNA_update:                     "off",
      dna_align_core_CCDS:                            "off",
      fg_regulatory_features_funcgen:                 "off",
      fg_regulatory_features_legend:                  "off",
      gene_legend:                                    "off",
      gc_plot:                                        "off",
      info:                                           "off",
      missing:                                        "off",
      transcript_core_ncRNA:                          "off",
      transcript_core_ensembl_IG_gene:                "off",
      variation_legend:                               "off"
    };
    var settings = [];
    jQuery.each( tracks_to_change, function( key, value ) {
      settings.push( key + "=" + value );
    });

    var ensembl_link = "http://www.ensembl.org/Mus_musculus/Location/View";
    ensembl_link += "?r="+chr+":"+max_left+"-"+min_right+";";
    ensembl_link += "contigviewbottom=" + settings.join(",");
  %>
  <tbody>
      <tr>
        <td> <%= b6_count %> </td> 
        <td> <%= s7_count %> </td> 
        <td> <%= micer_count %> </td>
        <td> <a href="<%= ensembl_link %>"> link </a> </td>
      </tr>
  </tbody>
</table>
